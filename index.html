<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/png" href="https://s-ando-biophysics.github.io/4MRNA-G4/Icons/icon-120.png" />
<link rel="manifest" href="https://s-ando-biophysics.github.io/4MRNA-G4/manifest.json" />
<meta name="theme-color" content="#F2F2F2" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="apple-touch-icon" sizes="120x120" href="https://s-ando-biophysics.github.io/4MRNA-G4/Icons/icon-120.png" />
<link rel="apple-touch-icon" sizes="152x152" href="https://s-ando-biophysics.github.io/4MRNA-G4/Icons/icon-152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="https://s-ando-biophysics.github.io/4MRNA-G4/Icons/icon-180.png" />
<title>4MRNA-G4</title>

<style>
  :root { --fg:#0b1021; --bg:#f7f7fb; --muted:#6b6f76; --accent:#3a68ff; }
  html,body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  header { padding: 18px; border-bottom: 1px solid #e7e7ee; background:#fff; position:sticky; top:0; z-index:10; }
  header h1 { margin:0; font-size:30px; text-align:center; }
  main { max-width: 1000px; margin: 0 auto; padding: 32px 16px; }
  section.card { background:#fff; border:1px solid #e9e9f2; border-radius:14px; padding:16px; margin-bottom:14px; box-shadow: 0 1px 0 rgba(0,0,0,0.02); }
  .grid { display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
  #gapsGrid { display:flex; gap:16px; flex-wrap:wrap; align-items:stretch; }
  .gap-card { flex:1 1 220px; min-width:220px; padding:4px; background:transparent; }
  .gap-card .grid-gap3 { display:flex; flex-direction:column; gap:12px; }
  label { display:block; font-size:12px; letter-spacing:.02em; color:var(--muted); margin-bottom:6px; }
  select, input[type="number"] { width:100%; padding:9px 11px; border:1px solid #dcdce6; border-radius:10px; font-size:14px; box-sizing:border-box; }
  .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  button { appearance:none; border:none; padding:10px 14px; font-weight:600; border-radius:10px; cursor:pointer; }
  button.primary { background: var(--accent); color:#fff; }
  button.ghost { background:#f0f3ff; color:#243b9f; }
  .muted { color:var(--muted); font-size:12px; }
  #viewer { position:relative; width:100%; height:520px; border:1px solid #e5e7ef; border-radius:12px; background:#fff; }
  #viewer .viewer_3Dmol_gl { position:absolute !important; top:0 !important; left:0 !important; }
  h2 { margin-top:8px; }
  footer { text-align:center; background:#fff; padding:24px 16px; border-top:1px solid #e7e7ee; font-size:14px; color:var(--muted); margin-top:16px; }
  footer .footer-main { margin-bottom:16px; }
  footer .footer-links { display:flex; justify-content:center; gap:24px; flex-wrap:wrap; margin-bottom:16px; }
  footer .footer-copyright { font-size:12px; }
  #viewerSpinner{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,0.75); z-index:5; border-radius:12px; }
  #viewerSpinner .spin{ width:36px; height:36px; border-radius:50%; border:4px solid #e5e7ef; border-top-color:#3a68ff; animation:spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>

<script src="https://unpkg.com/3dmol/build/3Dmol-min.js"></script>

</head>

<body>
<header>
  <h1><b>Model Builder for 4MRNA-G4</b></h1>
</header>

<main>
  <section class="card">
    <div class="grid">
      <div>
        <h2>Type of NA</h2>
        <select id="naType">
          <option value="DNA" selected>DNA</option>
          <option value="RNA">RNA</option>
        </select>
      </div>
      <div>
        <h2>Number of layers</h2>
        <select id="numLayers">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
        </select>
      </div>
      <div>
        <h2>Handedness</h2>
        <select id="globalHand">
          <option value="right" selected>Right-handed</option>
          <option value="left">Left-handed</option>
        </select>
      </div>
      <div>
        <h2>Topology</h2>
        <select id="topology">
          <option value="parallel" selected>Parallel</option>
          <option value="antiparallel-basket">Antiparallel (Basket)</option>
          <option value="antiparallel-chair">Antiparallel (Chair)</option>
          <option value="hybrid">Hybrid</option>
        </select>
      </div>
    </div>
  </section>
  <section id="layersSection" class="card" style="display:none;">
    <h2>Type of G-quartet on each layer</h2>
    <div id="layersGrid" class="grid"></div>
  </section>
  <section id="gapsSection" class="card" style="display:none;">
    <h2>Setting between layers</h2>
    <div id="gapsGrid"></div>
  </section>
  <section id="actionsSection" class="card" style="display:none;">
    <div class="row">
      <button id="generateBtn" class="primary">Generate and View 3D structure</button>
      <button id="downloadBtn" class="primary" disabled>Download .pdb file</button>
      <span id="status" class="muted" role="status"></span>
    </div>
  </section>
  <section class="card">
    <div id="viewer" aria-label="3D viewer">
      <div id="viewerSpinner"><div class="spin" aria-label="Loading"></div></div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-main">
    <p>Massive Multi-type Model Molecular Replacement for Nucleic Acid G-quadruplexes (4MRNA-G4)</p>
  </div>
  <br>
  <div class="footer-links">
    <a href="https://github.com/S-Ando-Biophysics/4MRNA-G4" target="_blank">4MRNA-G4 GitHub repository</a>
    <a href="https://github.com/S-Ando-Biophysics/4MRNA" target="_blank">4MRNA (Duplex ver.) GitHub repository</a>
    <a href="https://s-ando-biophysics.github.io/4MRNA/" target="_blank">4MRNA (Duplex ver.) website</a>
  </div>
  <br>
  <div class="footer-copyright">Copyright Â© 2025 Shin Ando. All Rights Reserved.</div>
</footer>

<script src="https://s-ando-biophysics.github.io/4MRNA-G4/pdb.js"></script>
<script src="https://s-ando-biophysics.github.io/4MRNA-G4/math.js"></script>
<script src="https://s-ando-biophysics.github.io/4MRNA-G4/viewer.js"></script>
<script src="https://s-ando-biophysics.github.io/4MRNA-G4/build.js"></script>
<script src="https://s-ando-biophysics.github.io/4MRNA-G4/fitting.js"></script>
<script src="https://s-ando-biophysics.github.io/4MRNA-G4/generate.js"></script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('https://s-ando-biophysics.github.io/4MRNA-G4/sw.js')
      .then(reg => console.log('Service Worker registered:', reg))
      .catch(err => console.error('Service Worker registration failed:', err));
  });
}
</script>

</body>
</html>
